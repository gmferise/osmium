<!DOCTYPE html>
<html lang="en">
  <head>
	<title>Osmium</title>
	<link href="favicon.ico" rel="icon" type="image/png">
	
	<!-- Vue Styling -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!-- <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet"> -->
	<link href="style.css" rel="stylesheet" type ="text/css"/>
	
  </head>
  <script>
	
	function get12time(date) {
		var hours = date.getHours();
		var minutes = date.getMinutes();
		var ampm = hours >= 12 ? 'pm' : 'am';
		hours = hours % 12;
		hours = hours ? hours : 12; // the hour '0' should be '12'
		minutes = minutes < 10 ? '0'+minutes : minutes;
		var strTime = hours + ':' + minutes + ' ' + ampm;
		return strTime;
}
	
	function getColorClassFromStatus(statusName, isSentToTech) {
		if (isSentToTech == true) {
			return "tech"+statusName;
		} else {
			return statusName;
		}
	}
	
	var cards = [];
	function cardObjectFromElement(element,numParents) {
		var el = element;
		if (numParents == null) {
			numParents = 0;
		}
		for (var i=0; i<numParents; i++) {
			el = el.parentElement;
		}
		return cards[Array.from(el.parentElement.children).indexOf(el)-1];
	}
	
	//OBJECT - Card
	function new_Card(studentName, timeStamp, statusName, isSentToTech) {
		const obj = {};
		obj.name = studentName;
		obj.time = timeStamp;
		obj.status = statusName;
		obj.tech = isSentToTech
		
		//create card
		var wrap = document.createElement('div');
			wrap.classList.add('check-card');
			var btn = document.createElement('button');
				btn.setAttribute('onclick','cardObjectFromElement(this,1).clickAction();');
				var hover = document.createElement('div');
					hover.classList.add('tooltip');
				btn.appendChild(hover);
			wrap.appendChild(btn);
			var txtwrap = document.createElement('div');
				txtwrap.classList.add('text-holder');
				var txtmed = document.createElement('div');
					txtmed.classList.add('medium-text');
					txtmed.innerHTML = obj.name;
					var hover = document.createElement('div');
						hover.classList.add('tooltip');
					txtmed.appendChild(hover);
				txtwrap.appendChild(txtmed);
				var txtsml = document.createElement('div');
					txtsml.classList.add('small-text');
					txtsml.innerHTML = get12time(obj.time);
				txtwrap.appendChild(txtsml);
			wrap.appendChild(txtwrap);
			
		obj.card = wrap;
		
		//provide status name ("in"|"out") and tech status (true|false) to update proper styling and object's properties
		obj.updateStatusAndColor = function(statusName, isSentToTech) {
			var newcolor = getColorClassFromStatus(statusName, isSentToTech);
			obj.card.classList = "";
			obj.card.classList.add('check-card');
			obj.card.classList.add("color-card-"+newcolor);
			obj.status = statusName;
			obj.tech = isSentToTech;
		}
		obj.updateStatusAndColor(obj.status,obj.tech);
		
		obj.showComments = function() {
			var popup = document.createElement('div');
				popup.classList.add('card-popup');
				var container = document.createElement('div');
				container.classList.add('card-popup-container','color-bg-main');
					var close = document.createElement('button');
						close.classList.add('close','material-icons');
						close.innerHTML = 'close';
						close.setAttribute('onclick','this.parentElement.parentElement.remove()');
					container.appendChild(close);
					var header = document.createElement('div');
						header.classList.add('center-h','title');
						header.innerHTML = obj.name;
					container.appendChild(header);
				popup.appendChild(container);
			document.body.appendChild(popup);
		}
		
		//click the card's button - uses card's properties to determine action
		obj.clickAction = function() {
			if (!(obj.tech) && (obj.status=="in")) {
				//todo send "moved to tech" query
				obj.updateStatusAndColor("in",true);
				obj.playRefreshAnimation();
			} else {
				obj.showComments();
			}
		}
		
		obj.playRefreshAnimation = function() {
			obj.card.classList.add('anim-refresh');
			setTimeout(function() {
				obj.card.classList.remove('anim-refresh');
			},500);
		}
		
		obj.playInsertAnimation = function() {
			obj.card.classList.add('anim-in');
			setTimeout(function() {
				obj.card.classList.remove('anim-in');
			},500);
		}
		
		//insert into cards list at top
		obj.insertIntoCards = function() {
			document.getElementById("insert-cards").insertAdjacentElement('afterEnd',obj.card);
		};
		
		return obj;
	}
	
	var testnames = ["Marissa Hansen","Lynda Richmond","Roberto Brennan","Dwain Owens","Omer Mcintyre","Martina Grant","Bertram Weber","Milan Bryant","Louise Vincent","Margarita Guerra","Dorothea Sharp","Bertha Howell","Mable Gillespie","Marisa Mills","Lesley Ramirez","Burt Austin","Kathryn Weaver","Harrison Ferguson","Alonzo Zamora","Jean Munoz","Brain Wood","Osvaldo Berger","Debra Hayes","Luke Sheppard","Elisabeth Dougherty","Trey Velez","Edgardo Macias","Javier Carpenter","Rene Simon","Cassandra Osborne","Wilford Finley","Heriberto Odonnell","Beau Terry","Miquel Mendez","Garry Tyler","Anita Tapia","Kim Campos","Dane Griffith","Liliana Blackwell","Pamela Sims","Owen Cook","Joel Gomez","Marshall Carson","Bernadette Poole","Hiram Mcclain","Amanda Walters","Monte Ball","Toney Yoder","Brett Choi","Elsa Jones"];
	function test() {
		for (var i=0; i<parseInt(Math.random() * 5)+1; i++) {
		if (parseInt(Math.random() * 2) == 0) {
			var card = new_Card(testnames[parseInt(Math.random() * 50)],new Date(new Date().getTime()+Math.random()*100000000),"in",parseInt(Math.random()*2));
			cards.unshift(card); //unshift pushes to start instead of end... weirdname.
			card.insertIntoCards();
		} else {
			var card = new_Card(testnames[parseInt(Math.random() * 50)],new Date(new Date().getTime()+Math.random()*100000000),"out",parseInt(Math.random()*2));
			cards.unshift(card);
			card.insertIntoCards();
		}
		card.playInsertAnimation();
		}
	}
	
function updateTodaysDate() {
	//var now = new Date(new Date().getTime()+Math.random()*100000000000)
	var now = new Date();
	var s = now.toLocaleString('en-US',{weekday:'long',month:'long',day:'numeric'});
	var d = s.split(", ");
	d[0] += ",";
	d.push(get12time(now));
	var here = document.getElementById('todays-date');
	for (var i=0; i<d.length; i++) {
		here.children[i].innerHTML = d[i];
	}
	var now = new Date();
	setTimeout(function(){updateTodaysDate();},60000-((now.getSeconds()*1000)+now.getMilliseconds())); //timeout to refresh on next minute
}
	</script>
  <body class="color-bg-main">
	<!-- testing element -->
	<button class="center-h" style="position: absolute;left:0;top:0;z-index:10000;" onclick="test()">test: Press to add :)</button>
	<!-- end test-->
	<div class="split-left pretty-scrollbar-dark">
		<div class="small-spacer"></div>
		<div id='search-wrapper'>
			<div id='searchbar'>
				<i class="material-icons">search</i>
				<input type='text' id='searchfield' placeholder="Search"></input>
			</div>
		</div>
		<div id='cards-wrapper'>
			<div class="null-spacer" id="insert-cards"></div>
		</div>
	</div>
	<div class="split-right">
		<div id="overview-table">
			<div class="tablerow">
				<div id="todays-date" class="center-h title">
					<div class="center-h medium-text"></div>
					<div class="center-h medium-text"></div>
					<div class="center-h medium-text" style="padding-bottom:10px;"></div>
				</div>
			</div>
			
			<div class="tablerow">
				<div class="center-h title medium-text">In the Library</div>
				<div class="half-pair">
					<div class="left">
						<div class="large-text">10</div>
						<div class="small-text">Checked In</div>
					</div>
					<div class="middle"></div>
					<div class="right">
						<div class="large-text">2</div>
						<div class="small-text">In Tech</div>
					</div>
				</div>
			</div>
			
			<div class="tablerow">
				<div class="center-h title medium-text">Today's Traffic</div>
				<div class="half-pair">
					<div class="left">
						<div class="large-text">23</div>
						<div class="small-text">Students</div>
					</div>
					<div class="middle"></div>
					<div class="right">
						<div class="large-text">5</div>
						<div class="small-text">Tech Issues</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- WIP ELEMENT -->
	<div id="checkout-popup" style="display: none">
		<div id="checkout-container" class="color-bg-alt">
			<div class="small-spacer"></div>
			<div class="title center-h">Check Out</div>
			<div class="medium-spacer"></div>
			<button class="close material-icons">close</button>
		</div>
	</div>
	<!-- END WIP -->
  </body>
</html>
<script>
updateTodaysDate();	
</script>
